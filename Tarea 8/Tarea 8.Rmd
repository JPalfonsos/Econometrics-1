---
title: "Taller 8"
author: "Juan Pablo Alfonso"
date: "10/5/2021"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
**Definición de variables**
tasa_fatal: número de fatalidades por millón de millas transitables en el estado
- tasa_cint: tasa de uso del cinturón
- vel_65: binaria 1 para estados con límite de velocidad 65 millas/hora
- vel_70: binaria 1 para estados con límite de velocidad 70 millas/hora
- niv_alc08: binaria 1 para estados en donde el nivel alcohólico máximo es .08%
- ed_alc21: binaria 1 para estados en donde la edad mínima consumo alcohol 21
- ingreso: ingreso per cápita en el estado
- edad: media de la edad en el estado
- primario: dummy 1 si en el estado la policía puede detener por no uso cinturón
- secundario: dummy 1 sin el estado la policía solo detiene por otras violaciones
- mmt: millones de millas transitables
- cod: código numérico del estado
- ano: año de la observación
- estado: abreviación postal de cada estado
**PUNTO 1**

```{r}
setwd("C:/Users/Juan Pablo/Documents/Econometrics-1")


cint <- read.csv("cinturon.csv", stringsAsFactors = FALSE)

library(lmtest)
library(tinytex)
library(stargazer)
library(ggplot2)
library(tidyverse)
library(datasets)
library(rlang)
library(tibble)
library(dplyr)
library(hrbrthemes)
library(viridis)
library(reshape2)
```

**Punto 1a**
Inspirados en el paper de Cohen y Einav, 2003, harémos un análisis de la efectividad de reglas e incentivos sobre la conducción en carretera para disminuir los accidentes en estados norteamericanos, usaremos una serie de tiempo segregada por estados desde 1983 hasta 1997.

Primero revisaremos gráficamente la evolución de muertes de los 5 estados que en 1983 tuvieron el mayor número de muertes en carretera son:

```{r}
cint83<-filter(cint,cint$ano=="1983") %>%
  arrange(desc(tasa_fatal)) %>%
  slice(1:5)
cint83
```


- NM:Nuevo México
- AK: Alaska
- MS: Mississippi
- MT: Montana
- NV: Nevada

Proyectando los datos para estos 5 estados desde 1983 hasta 1997 encontramos:
```{r}
cint5<-cint%>%
  filter(estado %in% c("NM","AK","MS","MT","MT","NV"))

años<-cint5$ano
#cada estado

NM <- cint%>%
  filter(cint$estado== "NM")
Nuevo_México<-NM$tasa_fatal


AK <- cint%>%
  filter(cint$estado== "AK")
Alaska<-AK$tasa_fatal


MS <- cint%>%
  filter(cint$estado== "MS")
Mississippi<-MS$tasa_fatal

MT <- cint%>%
  filter(cint$estado== "MT")
Montana<-MT$tasa_fatal

NV <- cint%>%
  filter(cint$estado== "NV")
Nevada<-NV$tasa_fatal

data<- data.frame(años,Nuevo_México,Alaska,Mississippi,Montana,Nevada)
data<- data%>% 
  slice(1:15)


```


```{r message=FALSE, warning=FALSE}

largos<-melt(data, id ="años")
GP<-ggplot(largos, aes(x=años, y=value, color=variable)) +
    geom_line() + 
    scale_color_viridis(discrete = TRUE) +
    theme_ipsum() +
    ylab("Fatalidades por millón de millas transitables")+
    xlab("1983-1997")
GP + labs(title = "Evolución de las muertes en carretera",
    subtitle = "De los 5 estados en U.S que tuvieron la mayor cantidad de muertos en 1983",
    caption = "Inspirado en el paper de Cohen y Einav, 2003")

```
La cantidad de muertes disminuyó para todos los que más muertes tenían en carretera, entre los factores que pudieron influir se encuentran los límites de velocidad, establecer límites de velocidad y respectivas multas, edad mínima de consumo de alcohol y limite máximo en pruebas de alcoholemia. Revisaremos el impacto de cada una de estas variables sobre la disminución de muertes que acabamos de ver gráficamente.

 






*Punto 1b*
```{r}
lm1 <- lm(tasa_fatal ~ tasa_cint, data = cint)
summary(lm1)

```
Son significativos, hay qué ver cómo cambia con fx fijos
Podría haber sesgo de variable omitida

durbin watson test:
mide autocorrelación serial de primer orden:
```{r}
dwtest(lm1)
```
2:no auto correlación 
0 y 2: auto correlación positiva:
no estoy bien de auto correlación bastante grande.
2 y 4: auto correlación negativa

otra forma de estimar los efectos fijos:

**c**
```{r}
lm2 <- lm(tasa_fatal ~ tasa_cint + vel_65
          + vel_70 
          + niv_alc08
          +ed_alc21
          + edad , data = cint)
summary(lm2)
dwtest(lm2)
```
intecepto sigue muy significativo y capuró la diferncia por estados de velocidad límite de 65
el intercepto estaba sobre estimado
tasa_cint estaba sub estimado

DPFJ: Diferencias que son propias de estados con limite 65


d)
```{r}
#putno estado sin intercepto
tablaestado<-table(cint$estado)
tablaestado

lmestado <- lm(tasa_fatal ~ tasa_cint + factor(estado)-1, data = cint)
summary(lmestado)


DTESTADO<-dwtest(lmestado)
print(DTESTADO)
```
MEJORÓ EL DURBIN WATSON

Comparación d

```{r}
summary(lmestado)$coef[1]



```

E)
```{r}
añoslm <- lm(tasa_fatal ~ tasa_cint + factor(estado) + factor(ano)-1 , data = cint)
summary(añoslm)
```

```
