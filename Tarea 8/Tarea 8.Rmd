---
title: "Taller 8"
author: "Juan Pablo Alfonso"
date: "10/5/2021"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

**Definición de variables**

- tasa_fatal: número de fatalidades por millón de millas transitables en el estado

- tasa_cint: tasa de uso del cinturón

- vel_65: binaria 1 para estados con límite de velocidad 65 millas/hora

- vel_70: binaria 1 para estados con límite de velocidad 70 millas/hora

- niv_alc08: binaria 1 para estados en donde el nivel alcohólico máximo es .08%

- ed_alc21: binaria 1 para estados en donde la edad mínima consumo alcohol 21

- ingreso: ingreso per cápita en el estado

- edad: media de la edad en el estado

- primario: dummy 1 si en el estado la policía puede detener por no uso cinturón

- secundario: dummy 1 sin el estado la policía solo detiene por otras violaciones

- mmt: millones de millas transitables

- cod: código numérico del estado

- ano: año de la observación

- estado: abreviación postal de cada estado


**PUNTO 1**

```{r message=FALSE, warning=FALSE, include=FALSE}
setwd("C:/Users/Juan Pablo/Documents/Econometrics-1/Tarea 8")


cint <- read.csv("cinturon.csv", stringsAsFactors = FALSE)

library(lmtest)
library(tinytex)
library(stargazer)
library(ggplot2)
library(tidyverse)
library(datasets)
library(rlang)
library(tibble)
library(dplyr)
library(hrbrthemes)
library(viridis)
library(reshape2)
library(knitr)
library(kableExtra)
```

**Punto 1a**

Inspirados en el paper de Cohen y Einav, 2003, harémos un análisis de la efectividad de reglas e incentivos sobre la conducción en carretera para disminuir los accidentes en estados norteamericanos, usaremos una serie de tiempo segregada por estados desde 1983 hasta 1997.

Primero revisaremos gráficamente la evolución de muertes de los 5 estados que en 1983 tuvieron el mayor número de muertes en carretera son:

```{r echo=FALSE}
cint83<-filter(cint,cint$ano=="1983") %>%
  arrange(desc(tasa_fatal)) %>%
  slice(1:5) 
cint83 <- 
  select(cint83, -c(cod,mmt,tasa_cint,vel_65,vel_70,ed_alc21,niv_alc08,ingreso,edad,primario,secundario))



top_5_estados<-kable( cint83 , caption = "Top 5 estados con más tasas de fatalidad en 1983"
       , align = c('l', 'c', 'r')
       , col.names = c("Estado","Año","Tasa Fata")
       , row.names = TRUE
       , digits = 10
       , format.args = list( decimal.mark = ",")
      )
top_5_estados
```


- NM:Nuevo México

- AK: Alaska

- MS: Mississippi

- MT: Montana

- NV: Nevada

Proyectando los datos para estos 5 estados desde 1983 hasta 1997 encontramos:

```{r include=FALSE}
cint5<-cint%>%
  filter(estado %in% c("NM","AK","MS","MT","MT","NV"))

años<-cint5$ano
#cada estado

NM <- cint%>%
  filter(cint$estado== "NM")
Nuevo_México<-NM$tasa_fatal


AK <- cint%>%
  filter(cint$estado== "AK")
Alaska<-AK$tasa_fatal


MS <- cint%>%
  filter(cint$estado== "MS")
Mississippi<-MS$tasa_fatal

MT <- cint%>%
  filter(cint$estado== "MT")
Montana<-MT$tasa_fatal

NV <- cint%>%
  filter(cint$estado== "NV")
Nevada<-NV$tasa_fatal

data<- data.frame(años,Nuevo_México,Alaska,Mississippi,Montana,Nevada)
data<- data%>% 
  slice(1:15)


```


```{r echo=FALSE, message=FALSE, warning=FALSE}
largos<-melt(data, id ="años")
GP<-ggplot(largos, aes(x=años, y=value, color=variable)) +
    geom_line() + 
    
    ylab("Fatalidades por millón de millas transitables")+
    xlab("1983-1997")
GP + labs(title = "Evolución de las muertes en carretera",
    subtitle = "De los 5 estados en U.S que tuvieron la mayor cantidad de muertos en 1983",
    caption = "Inspirado en el paper de Cohen y Einav, 2003")


```

La cantidad de muertes disminuyó para todos los que más muertes tenían en carretera, entre los factores que pudieron influir se encuentran los límites de velocidad, establecer límites de velocidad y respectivas multas, edad mínima de consumo de alcohol y limite máximo en pruebas de alcoholemia. Revisaremos el impacto de cada una de estas variables sobre la disminución de muertes que acabamos de ver gráficamente.

 






*Punto 1b*

Comenzaremos evaluando el impacto de la tasa del uso de cinturón para todos los estados en todos los años sobre la fatalidad carretera.

_Modelo 1:_

$$ tasa fatal=B_0 + B_1tasacint_i+E_i$$



```{r}
lm1 <- lm(tasa_fatal ~ tasa_cint, data = cint)
stargazer(lm1, 
          header=FALSE,
          type = "text",
          title="Modelo 1",
          digits=3, single.row=FALSE,
          intercept.bottom=TRUE, 
          covariate.labels=c("Tasa uso del cinturón"),
          df = FALSE, style = "qje")
```
Nuestras hipótesis son:
$$h_o: B_1=0$$
$$h_o: B_1\ne0$$
Del primer modelo inferimos que:

-En promedio cuando en ningún estado se usa el cinturón de seguridad hay 0.026 muertes por millón de millas

-En promedio entre más personas usan el cinturón, las muertes por millón de millas disminuyen en todos los estados

Por ende rechazamos la hipótesis nula, con una confianza del 99% la tasa de uso de cinturón afecta la variabilidad de la cantidad de muertos en los estados de forma negativa. 

En promedio el 16.2% (r^2: 0.162) de la variabilidad de los muertos por millón de millas en carreteras son explicados por la tasa de uso de cinturón.


Sin embargo podríamos caer en un sesgo de variable omitida, hay qué ver cómo cambia con efectos fijos.

Realizaremos el test de durbin watson, este nos permitirá medir la autocorrelación serial de primer orden:

```{r echo=FALSE}
dwtest(lm1)
```
_La forma de interpretarlo es:_

**2:no auto correlación **

**0 y 2: auto correlación positiva:**

**2 y 4: auto correlación negativa**

De acuerdo a esto podemos decir que no estamos bien de auto correlación, es bastante grande, es decir que los efectos por año pasan de año en año, lo que implica que podríamos afirmar que si ayer hubo accidentes; hoy también habrán en nuestro modelo 1.


Ahora exploraremos qué ocurre si incluimos más variables a nuestro modelo


**Punto 1c**

*Moldelo 2*
```{r message=FALSE, warning=FALSE}
cint$ln_ingreso <- log(cint$ingreso)

lm2 <- lm(tasa_fatal ~ tasa_cint + vel_65
          + vel_70 
          +niv_alc08
          +ed_alc21
          +edad + ln_ingreso , data = cint)

stargazer(lm2, 
          header=FALSE,
          type = "text",
          title="Modelo 2",
          digits=3, single.row=FALSE,
          intercept.bottom=TRUE, 
          covariate.labels=c("Tasa de uso cinturon"),
          df = FALSE, style = "qje")
```
De modelo 2 inferimos que el intercepto sigue muy significativo (***) y se capturó la diferencia por estados de velocidad límite de 65 ya que este límite 65 no fue significativo en este segundo modelo

El intercepto estaba sobre estimado, pasamos de (0.026***) a (0.197 con significancia del 99% )
-0.012***  0.004*** tasa_cint estaba sub estimado

DPFJ: Diferencias que son propias de estados con limite 65

```{r}
dwtest(lm2)
```


d)
```{r}
#punto estado sin intercepto
tablaestado<-table(cint$estado)


lmestado <- lm(tasa_fatal ~ tasa_cint + factor(estado)-1, data = cint)
stargazer(lmestado, 
          header=FALSE,
          type = "text",
          title="modelo 3",
          digits=3, single.row=FALSE,
          intercept.bottom=TRUE, 
          covariate.labels=c("Tasa de uso cinturon"),
          df = FALSE, style = "qje")

DTESTADO<-dwtest(lmestado)

```
MEJORÓ EL DURBIN WATSON

Comparación d

```{r}
summary(lmestado)$coef[1]



```

E)
```{r}
añoslm <- lm(tasa_fatal ~ tasa_cint + factor(estado) + factor(ano)-1 , data = cint)
summary(añoslm)
```

```
